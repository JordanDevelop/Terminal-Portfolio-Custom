!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Custombox=e()}(this,function(){"use strict";var t={target:null,cache:!1,escKey:!0,zIndex:9999,overlay:!0,overlayColor:"#000",overlayOpacity:.8,overlayClose:!0,overlaySpeed:300,overlayEffect:"auto",width:null,effect:"fadein",position:["center","center"],animation:null,speed:500,loading:!1,open:null,complete:null,close:null},e={oldIE:navigator.appVersion.indexOf("MSIE 8.")>-1||navigator.appVersion.indexOf("MSIE 9.")>-1,oldMobile:/(iPhone|iPad|iPod)\sOS\s6/.test(navigator.userAgent),overlay:{perspective:["letmein","makeway","slip"],together:["corner","slidetogether","scale","door","push","contentscale","simplegenie","slit","slip"]},modal:{position:["slide","flip","rotate"],animationend:["swell","rotatedown","flash"]}},n={set:function(n){if(this.cb&&this.cb.length||(this.cb=[],this.item=-1),this.item++,n&&"auto"===n.zIndex){for(var i=0,s=0,o=document.getElementsByTagName("*"),a=o.length;a>s;s+=1){var l=window.getComputedStyle(o[s]).getPropertyValue("z-index");l&&(l=+l,l>i&&(i=l))}n.zIndex=i}this.cb.push({settings:e.oldIE&&"undefined"!=typeof cbExtendObjects?cbExtendObjects({},t,n):Object.assign({},t,n)}),"auto"===this.cb[this.item].settings.overlayEffect&&(this.cb[this.item].settings.overlayEffect=this.cb[this.item].settings.effect)},get:function(){return this.cb[this.cb.length-1]||null},init:function(){document.documentElement.classList.add("custombox-open"),document.documentElement.classList.add("custombox-open-"+this.cb[this.item].settings.overlayEffect),e.overlay.perspective.indexOf(this.cb[this.item].settings.overlayEffect)>-1&&(this.cb[this.item].scroll=document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0,document.documentElement.classList.add("custombox-perspective"),window.scrollTo(0,0)),this.main||this.built("container"),this.cb[this.item].settings.loading&&this.cb[this.item].settings.loading.parent&&this.built("loading"),this.cb[this.item].settings.overlay?this.built("overlay").built("modal").open():this.built("modal").open(),this.binds()},built:function(t){var n;switch("undefined"!=typeof this.item&&(n=this.cb[this.item]),t){case"container":for(this.main=document.createElement("div");document.body.firstChild;)this.main.appendChild(document.body.firstChild);document.body.appendChild(this.main);break;case"overlay":n.overlay||(n.overlay={}),n.overlay=document.createElement("div"),n.overlay.classList.add("custombox-overlay"),n.overlay.classList.add("custombox-overlay-"+n.settings.overlayEffect),n.overlay.style.zIndex=n.settings.zIndex+2,n.overlay.style.backgroundColor=n.settings.overlayColor,e.overlay.perspective.indexOf(n.settings.overlayEffect)>-1||e.overlay.together.indexOf(n.settings.overlayEffect)>-1?n.overlay.style.opacity=n.settings.overlayOpacity:n.overlay.classList.add("custombox-overlay-default"),e.overlay.together.indexOf(n.settings.overlayEffect)>-1?n.overlay.style.transitionDuration=n.settings.speed+"ms":n.overlay.style.transitionDuration=n.settings.overlaySpeed+"ms",document.body.insertBefore(n.overlay,document.body.lastChild.nextSibling);break;case"modal":"push"===n.settings.overlayEffect&&(this.main.style.transitionDuration=n.settings.speed+"ms"),this.main.classList.add("custombox-container"),this.main.classList.add("custombox-container-"+n.settings.overlayEffect),n.wrapper=document.createElement("div"),n.wrapper.classList.add("custombox-modal-wrapper"),n.wrapper.classList.add("custombox-modal-wrapper-"+n.settings.effect),n.wrapper.style.zIndex=n.settings.zIndex+3,document.body.insertBefore(n.wrapper,document.body.lastChild.nextSibling),n.container=document.createElement("div"),n.container.classList.add("custombox-modal-container"),n.container.classList.add("custombox-modal-container-"+n.settings.effect),n.container.style.zIndex=n.settings.zIndex+4,e.modal.position.indexOf(n.settings.effect)>-1&&null===n.settings.animation&&("slide"===n.settings.effect?n.settings.animation=["top"]:"flip"===n.settings.effect?n.settings.animation=["horizontal"]:n.settings.animation=["bottom"]),n.modal=document.createElement("div"),n.modal.classList.add("custombox-modal"),n.modal.classList.add("custombox-modal-"+n.settings.effect+(e.modal.position.indexOf(n.settings.effect)>-1?"-"+n.settings.animation[0].trim():"")),n.modal.style.transitionDuration=n.settings.speed+"ms",n.modal.style.zIndex=n.settings.zIndex+4,n.wrapper.appendChild(n.container).appendChild(n.modal);break;case"loading":this.loading=document.createElement("div"),this.loading.classList.add("custombox-loading");for(var i=document.createElement("div"),s=0,o=this.cb[this.item].settings.loading.parent.length;o>s;s++)i.classList.add(this.cb[this.item].settings.loading.parent[s]);if(this.loading.appendChild(i),this.loading.style.zIndex=n.settings.zIndex+3,this.cb[this.item].settings.loading.childrens)for(var a=0,l=this.cb[this.item].settings.loading.childrens.length;l>a;a++){for(var r=document.createElement("div"),c=0,d=this.cb[this.item].settings.loading.childrens[a].length;d>c;c++)r.classList.add(this.cb[this.item].settings.loading.childrens[a][c]);i.appendChild(r)}document.body.appendChild(this.loading)}return this},load:function(){var t=this.cb[this.item];if("function"==typeof t.settings.open&&t.settings.open.call(),document.createEvent){var e=document.createEvent("Event");e.initEvent("custombox.open",!0,!0),document.dispatchEvent(e)}return null!==t.settings.target&&Array.isArray(t.settings.position)?"#"===t.settings.target.charAt(0)||"."===t.settings.target.charAt(0)&&"/"!==t.settings.target.charAt(1)?document.querySelector(t.settings.target)?(t.inline=document.createElement("div"),t.content=document.querySelector(t.settings.target),t.display="none"===t.content.style.display,t.content.style.display="block",t.content.parentNode.insertBefore(t.inline,t.content),this.size()):this.error():this.ajax():this.error(),this},size:function(){var t=this.cb[this.item],n=t.content.offsetWidth;if(e.oldIE&&(window.innerHeight=document.documentElement.clientHeight),t.inline||(e.oldIE?t.content.style.styleFloat="none":t.content.style.cssFloat="none"),null!==t.settings.width&&(isNaN(t.settings.width)?(n=window.innerWidth,t.content.style.height=window.innerHeight+"px"):n=parseInt(t.settings.width,0)),t.size=n,t.size+60>=window.innerWidth){t.container.style.width="auto","full"!==t.settings.width&&(t.container.style.margin="5%"),t.wrapper.style.width=window.innerWidth+"px";for(var i=0,s=t.content.querySelectorAll(":scope > *"),o=s.length;o>i;i++)s[i].offsetWidth>window.innerWidth&&(s[i].style.width="auto")}else{switch(t.settings.position[0].trim()){case"left":t.container.style.marginLeft=0;break;case"right":t.container.style.marginRight=0}t.container.style.width=t.size+"px"}if(t.content.style.width="auto",t.modal.appendChild(t.content),t.content.offsetHeight>=window.innerHeight&&"full"!==t.settings.width)t.container.style.marginTop="5%",t.container.style.marginBottom="5%";else{var a;switch(t.settings.position[1].trim()){case"top":a=0;break;case"bottom":a=window.innerHeight-t.content.offsetHeight+"px";break;default:a=window.innerHeight/2-t.content.offsetHeight/2+"px"}t.container.style.marginTop=a}this.loading&&(document.body.removeChild(this.loading),delete this.loading),t.wrapper.classList.add("custombox-modal-open")},ajax:function(){var t=this,n=t.cb[t.item],i=new XMLHttpRequest,s=document.createElement("div");i.onreadystatechange=function(){4===i.readyState&&(200===i.status?(s.innerHTML=i.responseText,n.content=s,n.content.style.display="block",e.oldIE?n.content.style.styleFloat="left":n.content.style.cssFloat="left",n.container.appendChild(n.content),t.size()):t.error())},i.open("GET",n.settings.target+(n.settings.cache?"":(/[?].+=/.test(n.settings.target)?"&_=":"?_=")+Date.now()),!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(null)},scrollbar:function(){var t=document.createElement("div");t.classList.add("custombox-scrollbar"),document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e},open:function(){var t=this,n=0,i=t.cb[t.item],s=t.scrollbar();s&&(document.body.style.paddingRight=s+"px"),t.main.classList.add("custombox-container-open"),t.cb[t.item].settings.loading&&(n=t.cb[t.item].settings.loading.delay&&!isNaN(1*t.cb[t.item].settings.loading.delay)?1*t.cb[t.item].settings.loading.delay:1e3);var o=function(e){e&&i.overlay.removeEventListener("transitionend",o),t.load(),i.inline&&i.wrapper.classList.add("custombox-modal-open")};return i.settings.overlay?(e.overlay.perspective.indexOf(i.settings.overlayEffect)>-1||e.overlay.together.indexOf(i.settings.overlayEffect)>-1?i.overlay.classList.add("custombox-overlay-open"):i.overlay.style.opacity=i.settings.overlayOpacity,t.cb[t.item].settings.loading?setTimeout(o,n):e.overlay.together.indexOf(i.settings.overlayEffect)>-1||e.oldIE?o(!1):i.overlay.addEventListener("transitionend",o,!1)):t.cb[t.item].settings.loading?setTimeout(o,n):o(!1),t},clean:function(t){var n=this,i=this.cb[t];if(document.documentElement.classList.remove("custombox-open-"+i.settings.overlayEffect),i.settings.overlay&&(i.overlay.style.opacity&&(i.overlay.style.opacity=0),i.overlay.classList.remove("custombox-overlay-open"),n.main.classList.remove("custombox-container-open")),e.oldIE||e.oldMobile||!i.overlay)n.remove(t);else{var s=function(){i.overlay.removeEventListener("transitionend",s),n.remove(t)};i.overlay.addEventListener("transitionend",s,!1)}},remove:function(t){var n=this,i=this.cb[t];if(i){if(1===n.cb.length&&(document.documentElement.classList.remove("custombox-open","custombox-perspective"),n.scrollbar()&&(document.body.style.paddingRight=0),"undefined"!=typeof i.scroll&&window.scrollTo(0,i.scroll)),i.inline&&(e.oldIE?(i.content.style.removeAttribute("width"),i.content.style.removeAttribute("height"),i.content.style.removeAttribute("display")):(i.content.style.removeProperty("width"),i.content.style.removeProperty("height"),i.content.style.removeProperty("display")),i.display&&(i.content.style.display="none"),i.inline.parentNode.replaceChild(i.content,i.inline)),n.main.classList.remove("custombox-container-"+i.settings.overlayEffect),i.wrapper.parentNode.removeChild(i.wrapper),i.settings.overlay&&i.overlay.parentNode.removeChild(i.overlay),document.createEvent){var s=document.createEvent("Event");s.initEvent("custombox.close",!0,!0),document.dispatchEvent(s)}if(1===n.cb.length){for(var o=document.querySelectorAll(".custombox-container > *"),a=0,l=o.length;l>a;a++)document.body.insertBefore(o[a],n.main);n.main.parentNode&&n.main.parentNode.removeChild(n.main),delete n.main}n.cb.splice(t,1),"function"==typeof i.settings.close&&i.settings.close.call()}},close:function(t,n){var i,s=this;if(t){for(var o=0,a=this.cb.length;a>o;o++)if(this.cb[o].settings.target===t){i=o;break}}else i=s.cb.length-1;var l=s.cb[i];if("function"==typeof n&&(l.settings.close=n),e.modal.position.indexOf(l.settings.effect)>-1&&l.settings.animation.length>1&&(l.modal.classList.remove("custombox-modal-"+l.settings.effect+"-"+l.settings.animation[0]),l.modal.classList.add("custombox-modal-"+l.settings.effect+"-"+l.settings.animation[1].trim())),l.wrapper.classList.remove("custombox-modal-open"),e.oldIE||e.oldMobile||e.overlay.together.indexOf(l.settings.overlayEffect)>-1)s.clean(i);else{var r=function(){l.wrapper.removeEventListener("transitionend",r),s.clean(i)};e.modal.animationend.indexOf(l.settings.effect)>-1?l.wrapper.addEventListener("animationend",r,!1):l.wrapper.addEventListener("transitionend",r,!1)}},responsive:function(){e.oldIE&&(window.innerHeight=document.documentElement.clientHeight);for(var t,n=0,i=this.cb.length;i>n;n++){if(this.cb[n].size+60>=window.innerWidth)"full"!==this.cb[n].settings.width?(this.cb[n].container.style.marginLeft="5%",this.cb[n].container.style.marginRight="5%"):this.cb[n].content.offsetWidth<=window.innerWidth&&(this.cb[n].content.style.width="auto"),this.cb[n].container.style.width="auto",this.cb[n].wrapper.style.width=window.innerWidth+"px";else{switch(this.cb[n].settings.position[0].trim()){case"left":this.cb[n].container.style.marginLeft=0;break;case"right":this.cb[n].container.style.marginRight=0;break;default:this.cb[n].container.style.marginLeft="auto",this.cb[n].container.style.marginRight="auto"}this.cb[n].container.style.width=this.cb[n].size+"px",this.cb[n].wrapper.style.width="auto"}if(this.cb[n].content.offsetHeight>=window.innerHeight&&"full"!==this.cb[n].settings.width)this.cb[n].container.style.marginTop="5%",this.cb[n].container.style.marginBottom="5%";else{switch("full"===this.cb[n].settings.width&&(this.cb[n].settings.position[1]="top",this.cb[n].content.offsetHeight<=window.innerHeight&&(this.cb[n].content.style.height=window.innerHeight+"px")),this.cb[n].settings.position[1].trim()){case"top":t=0;break;case"bottom":t=window.innerHeight-this.cb[n].content.offsetHeight+"px";break;default:t=window.innerHeight/2-this.cb[n].content.offsetHeight/2+"px"}this.cb[n].container.style.marginTop=t}}},binds:function(){var t=this,n=t.cb[t.item],i=!1;1===t.cb.length&&(t.esc=function(e){1===t.cb.length&&document.removeEventListener("keydown",t.esc),e=e||window.event,!i&&27===e.keyCode&&t.get()&&t.get().settings.escKey&&(i=!0,t.close())},document.addEventListener("keydown",t.esc,!1),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){t.responsive()},!1)),n.wrapper.event=function(e){1===t.cb.length&&document.removeEventListener("keydown",n.wrapper.event),!i&&e.target===n.wrapper&&t.get()&&t.get().settings.overlayClose&&(i=!0,t.close())},n.wrapper.addEventListener("click",n.wrapper.event,!1),document.addEventListener("custombox.close",function(){i=!1});var s=function(){if(!n.inline)for(var t=0,e=n.modal.getElementsByTagName("script"),i=e.length;i>t;t++)new Function(e[t].text)();if(n.settings&&"function"==typeof n.settings.complete&&n.settings.complete.call(),document.createEvent){var s=document.createEvent("Event");s.initEvent("custombox.complete",!0,!0),document.dispatchEvent(s)}},o=function(){s(),n.modal.removeEventListener("transitionend",o)};e.oldIE||e.oldMobile?setTimeout(function(){s()},n.settings.overlaySpeed):"slit"!==n.settings.effect?n.modal.addEventListener("transitionend",o,!1):n.modal.addEventListener("animationend",o,!1)},error:function(){var t=this,e=t.cb.length-1;alert("Error to load this target: "+t.cb[e].settings.target),t.remove(e)}};return{set:function(t){t.autobuild&&n.built("container")},open:function(t){n.set(t),n.init()},close:function(t,e){"function"==typeof t&&(e=t,t=!1),n.close(t,e)}}});